name:                   docs

on:
  repository_dispatch:
    types:              [docs-command]

jobs:
  # create docs.
  docs:
    name:               Docs
    runs-on:            ubuntu-latest

    steps:
      # checkout the `main` branch.
      - name:           Checkout
        uses:           actions/checkout@v2
        with:
          token:        ${{ secrets.GITHUB_TOKEN }}
          repository:   ${{ github.event.client_payload.pull_request.head.repo.full_name }}
          ref:          ${{ github.event.client_payload.pull_request.head.ref }}
      # create documentation for `Swiftagram`.
      - name:           Docs (Swiftagram)
        uses:           SwiftDocOrg/swift-doc@master
        with:
          base-url:     "https://sbertix.github.io/Swiftagram/Swiftagram/"
          format:       "html"
          inputs:       "Sources"
          module-name:  Swiftagram
          output:       docs/Swiftagram
      # create documentation for `SwiftagramCrypto`.
      - name:           Docs (SwiftagramCrypto)
        uses:           SwiftDocOrg/swift-doc@master
        with:
          base-url:     "https://sbertix.github.io/Swiftagram/SwiftagramCrypto/"
          format:       "html"
          inputs:       "Sources"
          module-name:  SwiftagramCrypto
          output:       docs/SwiftagramCrypto
      # update permissions.
      - name:           Update Permissions
        run:            'sudo chown --recursive $USER docs'
      # publish to GitHub pages.
      - name:           Publish
        uses:           JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.CHATOPS_PAT }}
          BRANCH:       gh-pages
          FOLDER:       docs
      # notify.
      - name:             Notify
        uses:             peter-evans/create-or-update-comment@v1
        with:
          comment-id:     ${{ github.event.client_payload.github.payload.comment.id }}
          reaction-type:  +1
